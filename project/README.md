
# 콘솔 기반 티켓 예매 시스템 (Ticket Reservation System)

이 프로젝트는 **자바의 객체지향 프로그래밍(OOP)**과 **제네릭(Generics)** 학습을 목적으로 작성된 티켓 예약 시뮬레이션 프로그램입니다. 기존의 절차지향적인 코드에서 벗어나, 시스템(Ticket System)과 외부 세계(User, Bank)를 분리하고, 역할과 책임을 나누는 구조 개선(Refactoring)에 중점을 두었습니다.

## 프로젝트 개요

- **주제:** 10×10 공연장 좌석 예매 및 결제 시뮬레이션

- **학습 목표:**

  - 클래스와 객체의 역할 분리 (User vs Account, System vs External)

  - **제네릭(Generics)**을 활용한 공통 저장소(`Repository`) 구현

  - 인터페이스를 활용한 결제 시스템의 유연한 연결

  - 예외 처리를 통한 트랜잭션(결제 실패 시 좌석 취소) 구현


## 주요 기능

### 1. 시뮬레이션 환경 (Simulation)

- **외부 세계 구현:** 실제 사용자(`Person`)와 외부 은행(`Bank`)을 티켓 시스템과 분리하여 구현했습니다.

- **시나리오 실행:** 사용자가 콘솔에 직접 입력하는 방식 대신, `ScenarioRunner`를 통해 회원가입 → 로그인 → 예매 → 결제 실패/성공 → 취소/환불로 이어지는 시나리오가 자동으로 실행됩니다.


### 2. 티켓팅 시스템 (Ticket System)

- **공연장 관리:** 10×10 좌석을 관리하며, VIP석(1~2열)과 일반석을 구분합니다.

- **예매 및 취소:** 로그인된 사용자의 요청을 받아 좌석을 선점하거나 취소합니다.

- **검증 로직:** 이미 예약된 좌석, 존재하지 않는 아이디, 본인이 아닌 좌석의 취소 시도 등을 철저히 검증합니다.


### 3. 사용자 및 인증 (Auth)

- **계정 분리:** 사용자의 실체(`Person`)와 시스템 접속용 계정(`Account`)을 분리했습니다.

- **회원가입/로그인:** 중복 가입을 방지하고, ID/PW 검증을 통해 로그인된 `Account` 객체를 반환합니다.


### 4. 결제 및 환불 (Payment)

- **결제 위임:** 티켓 시스템은 돈을 직접 관리하지 않고, `PaymentGateway` 인터페이스를 통해 외부 은행(`Bank`)에 결제를 요청합니다.

- **트랜잭션 처리:** 좌석 예약에는 성공했으나 잔액 부족으로 결제에 실패할 경우, 선점했던 좌석을 자동으로 취소(Rollback)하여 데이터 무결성을 보장합니다.


## 패키지 구성

|패키지|클래스/인터페이스|역할|
|---|---|---|
|**`simulation`**|`ScenarioRunner`|`main` 메서드가 포함된 실행 클래스. 전체 시나리오를 수행합니다.|
||`Person`|시스템 외부의 실제 사람(이름, 주민번호)을 나타냅니다.|
||`Bank`|외부 은행 시스템. 계좌 잔액 관리 및 입출금을 담당합니다.|
||`BankPaymentGateway`|은행 시스템을 티켓 시스템의 결제 규격에 맞게 연결해주는 어댑터입니다.|
|**`ticket.domain`**|`Account`|티켓 시스템 내부의 사용자 계정(ID, PW, 고유번호)입니다.|
||`Seat`|좌석 정보(위치, 가격, 예약자)를 담고 있습니다.|
|**`ticket.service`**|`AuthService`|회원가입, 로그인 등 인증 로직을 처리합니다.|
||`TicketService`|예매, 취소, 결제 요청 등 핵심 비즈니스 로직을 수행합니다.|
||`ConcertHall`|좌석 배열을 관리하고 상태를 변경하는 역할을 합니다.|
|**`ticket.repository`**|`Repository<T, ID>`|**[Generic]** 데이터를 저장하는 공통 인터페이스입니다.|
||`MemoryAccountRepository`|메모리 리스트(`List`)를 사용하여 계정 정보를 저장합니다.|
|**`ticket.gateway`**|`PaymentGateway`|외부 결제 시스템과 통신하기 위한 인터페이스 규격입니다.|
|**`ticket.exception`**|`ReservationException`|프로젝트 최상위 예외 클래스입니다.|
||`SeatException` 계열|좌석 관련 오류 (`AlreadyBooked`, `InvalidSeat` 등)|
||`PaymentException` 계열|결제 관련 오류 (`InsufficientBalance` 등)|
||`AuthException` 계열|인증 관련 오류 (`DuplicateUser`, `UserNotFound` 등)|

## 적용된 주요 자바 개념

### 1. 제네릭 (Generics)

모든 저장소가 공통으로 가져야 할 기능(저장, 조회, 삭제)을 `Repository<T, ID>` 인터페이스로 추상화했습니다.

- `T`: 저장할 데이터 타입 (예: `Account`)

- `ID`: 데이터를 식별하는 키 타입 (예: `Long`) 이를 통해 차후 `SeatRepository` 등이 추가되더라도 동일한 규격을 재사용할 수 있습니다.


### 2. 인터페이스와 다형성 (Interface & Polymorphism)

`TicketService`는 구체적인 은행(`Bank`)을 알지 못하며, 오직 `PaymentGateway` 인터페이스에만 의존합니다. 이로 인해 나중에 카카오페이, 신용카드 등 결제 수단이 바뀌어도 서비스 코드를 수정할 필요가 없습니다.

### 3. 예외 처리 (Exception Handling)

단순히 `boolean`이나 `String`을 반환하는 대신, 상황에 맞는 커스텀 예외(`ExampleException`)를 던지도록 구현했습니다. 이를 통해 `try-catch` 블록에서 에러 상황(예: 잔액 부족)을 명확하게 잡아내고, 적절한 복구 작업(좌석 취소)을 수행합니다.

## 실행 방법

**IntelliJ IDEA 또는 터미널 사용**

1. 프로젝트의 `src` 폴더로 이동합니다.

2. `simulation.ScenarioRunner` 클래스의 `main()` 메서드를 실행합니다.

3. 콘솔창에 철수(User)가 가입부터 예매, 환불까지 진행하는 과정이 로그로 출력됩니다.


Java

```
// 실행 결과 예시
--- 1. 외부 세계 세팅 ---
--- 2. 티켓팅 시스템 부팅 및 조립 (DI) ---
--- 3. 시나리오 시작 ---
[가입 시도]
가입 성공! 로그인 ID: chulsoo_id
...
[일반석 예매 시도 - 잔액 충분]
예매가 완료되었습니다! (좌석: 5행 5열)
결제 후 잔액: 5000원
```